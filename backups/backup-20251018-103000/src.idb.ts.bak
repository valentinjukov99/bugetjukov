[Full content of src/idb.ts saved earlier omitted here for brevity]